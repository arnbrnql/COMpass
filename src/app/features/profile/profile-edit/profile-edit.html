<div class="container mx-auto p-4 md:p-8 max-w-4xl">
  <div class="mb-8">
    <div class="flex items-center gap-3 mb-2">
      <app-back-button
        [iconOnly]="true"
        ariaLabel="Back to dashboard"
        (fallback)="goBack($event)"
      />
      <h1 class="text-3xl md:text-4xl font-bold">Edit Your Profile</h1>
    </div>
    <p class="text-base-content/70 ml-12">Update your information to help others connect with you</p>
  </div>

  @if (currentUser(); as user) {
    @if (successMessage()) {
      <div class="alert alert-success shadow-lg mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>{{ successMessage() }}</span>
      </div>
    }

    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex items-center gap-3 mb-6">
            <div class="p-2 bg-primary/10 rounded-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div>
              <h2 class="text-2xl font-bold">General Information</h2>
              <p class="text-sm text-base-content/60">Your basic profile details</p>
            </div>
          </div>

          <div class="space-y-4">
            <div class="form-control w-full">
              <label class="label">
                <span class="label-text font-semibold">Display Name</span>
                <span class="label-text-alt text-error">Required</span>
              </label>
              <input
                type="text"
                formControlName="displayName"
                class="input input-bordered w-full"
                placeholder="Enter your display name"
              />
              @if (profileForm.get('displayName')?.invalid && profileForm.get('displayName')?.touched) {
                <label class="label">
                  <span class="label-text-alt text-error">Display name is required</span>
                </label>
              }
            </div>

            <div class="form-control w-full">
              <label class="label">
                <span class="label-text font-semibold">Bio</span>
                <span class="label-text-alt">Optional</span>
              </label>
              <textarea
                id="bio"
                formControlName="bio"
                class="textarea textarea-bordered h-32 w-full"
                placeholder="Tell us a little about yourself..."
                autocomplete="off"
                aria-describedby="bio-counter"
                maxlength="500"
              ></textarea>
              <label class="label">
                <span class="label-text-alt text-base-content/60">Share your background, interests, or what you're looking for</span>
                <span class="label-text-alt" id="bio-counter">
                  {{ profileForm.get('bio')?.value?.length || 0 }}/500
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
      @if (user.roleFlags.isMentor) {
        <div class="card bg-base-100 shadow-xl" formGroupName="mentorProfile">
          <div class="card-body">
            <div class="flex items-center gap-3 mb-6">
              <div class="p-2 bg-success/10 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
              </div>
              <div>
                <h2 class="text-2xl font-bold">Mentor Profile</h2>
                <p class="text-sm text-base-content/60">Help mentees find you by sharing your expertise</p>
              </div>
            </div>

            <div class="space-y-4">
              <div class="form-control w-full">
                <label class="label">
                  <span class="label-text font-semibold">Areas of Expertise</span>
                  <span class="label-text-alt">Optional</span>
                </label>
                <input
                  type="text"
                  formControlName="expertise"
                  class="input input-bordered w-full"
                  placeholder="e.g., Angular, Product Management, Leadership"
                />
                <label class="label">
                  <span class="label-text-alt text-base-content/60">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Separate multiple skills with commas
                  </span>
                </label>
              </div>

              <div class="form-control w-full">
                <label class="label">
                  <span class="label-text font-semibold">Cal.com Username</span>
                  <span class="label-text-alt text-error">Required</span>
                </label>
                <div class="input-group">
                  <span class="bg-base-200 px-4 flex items-center text-base-content/60">cal.com/</span>
                  <input
                    type="text"
                    formControlName="calUsername"
                    class="input input-bordered flex-1"
                    [class.input-error]="profileForm.get('mentorProfile.calUsername')?.invalid && profileForm.get('mentorProfile.calUsername')?.touched"
                    placeholder="username"
                  />
                </div>
                @if (profileForm.get('mentorProfile.calUsername')?.invalid && profileForm.get('mentorProfile.calUsername')?.touched) {
                  <label class="label">
                    <span class="label-text-alt text-error">Cal.com username is required for mentors</span>
                  </label>
                }
                <label class="label">
                  <span class="label-text-alt text-base-content/60">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Mentees can book sessions after you approve their requests
                  </span>
                </label>
                <label class="label">
                  <span class="label-text-alt text-warning flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    Make sure this matches your actual Cal.com username - mentees won't be able to book if it's incorrect
                  </span>
                </label>
              </div>
            </div>
          </div>
        </div>
      }
      @if (user.roleFlags.isMentee) {
        <div class="card bg-base-100 shadow-xl" formGroupName="menteeProfile">
          <div class="card-body">
            <div class="flex items-center gap-3 mb-6">
              <div class="p-2 bg-info/10 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <div>
                <h2 class="text-2xl font-bold">Mentee Profile</h2>
                <p class="text-sm text-base-content/60">Share your goals to help mentors understand your journey</p>
              </div>
            </div>

            <div class="space-y-4">
              <div class="form-control w-full">
                <label class="label">
                  <span class="label-text font-semibold">Goals</span>
                  <span class="label-text-alt">Optional</span>
                </label>
                <input
                  type="text"
                  formControlName="goals"
                  class="input input-bordered w-full"
                  placeholder="e.g., Land a senior role, Build a side project"
                />
                <label class="label">
                  <span class="label-text-alt text-base-content/60">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Separate multiple goals with commas
                  </span>
                </label>
              </div>
            </div>
          </div>
        </div>
      }
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
            <button
              type="button"
              class="btn btn-ghost w-full sm:w-auto order-2 sm:order-1"
              (click)="goBack()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary w-full sm:w-auto order-1 sm:order-2"
              [disabled]="isSubmitting() || profileForm.invalid"
            >
              @if (isSubmitting()) {
                <span class="loading loading-spinner loading-sm"></span>
                Saving...
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Save Changes
              }
            </button>
          </div>
        </div>
      </div>
    </form>
  } @else {
    <div class="text-center py-20">
      <span class="loading loading-dots loading-lg"></span>
      <p class="mt-4 text-base-content/70">Loading profile...</p>
    </div>
  }
</div>
